{% extends "__layout_left_sidebar.html" %}

{% block sidebar_content %}
	{% include "_deck_nav.html" with collection=collection deck=deck is_quiz_mode=is_quiz_mode %}
{% endblock %}

{% block main_content %}

<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
<link href='http://fonts.googleapis.com/css?family=Vollkorn' rel='stylesheet' type='text/css'>


<div id="content"><!-- content (start) -->

    <div class="courseWrapper"><!-- courseWrapper (start) -->

        <div class="courseHeader"><!-- courseHeader (start) -->
			<a href="#" id="contentHere" title="Content Starts">Main content below</a>
            <h2 class="courseTitle">{{collection.title}}</h2><h3>{{deck.title}}</h3>
            {% if collection.id in user_collection_role.ADMIN %}
            <ul class="adminMenu adminMenuRight">
                <li><a href="#">Delete</a></li>
            </ul>
            {% endif %}
            <div style='float: right;'>
                {% if is_quiz_mode %}
                <a href="{% url 'deckIndex' deck.id %}" onclick="location.href=this.href+'?cardLoc='+(current+1);return false;">Switch to Review Mode</a>
                {% else %}
                <a href="{% url 'deckIndex' deck.id %}?mode=quiz" onclick="location.href=this.href+'&cardLoc='+(current+1);return false;">Switch to Quiz Mode</a>
                {% endif %}
            </div>
        </div><!-- courseHeader (end) -->
		{% if user.is_authenticated %}
        	<a href="#" id="addCard">Add Card</a>
        <div id="cardSlider" role="scrollbar" aria-orientation="horizontal">
        {% else %}
        <div id="cardSliderNotAdmin" role="scrollbar" tabindex="0" aria-orientation="horizontal">
        {% endif %}
            <div class="sliderBtns deckPrev">
            	<a id="prevCard" href="javascript:sliders[0].goToPrev()"><i class="fa fa-angle-left"></i><span>Previous</span></a>
            	<a id="firstCard" href="javascript:sliders[0].goToFirst()"><i class="fa fa-angle-double-left"></i><span>First</span></a>
            </div>
            <div class="cardHolder" id="holder">

                <ul id="cards">
                    {% for card in cards %}
                    <li role="presentation" id = {{forloop.counter0}} >
	                    <a class="card image" href="javascript:sliders[0].goToCard({{forloop.counter0}})" role="tab" tabindex="-1">
	                            {% for field in card.fields.reveal %}
	                                {% include "_deck_slider_card_fields.html" with field=field %}
	                            {% endfor %}
	                    </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            <div class="sliderBtns deckNext">
            	<a href="javascript:sliders[0].goToNext()"><i class="fa fa-angle-right"></i><span>Next</span></a>
            	<a href="javascript:sliders[0].goToLast()"><i class="fa fa-angle-double-right"></i><span>Last</span></a>
            </div>
        </div>
		
        <div class="fullcardBtns">
        	<a class="mobileFirst" href="javascript:fullCardSlider[0].goToFirst()"><i class="fa fa-angle-double-left"></i><span>First</span></a>
        	<a class="mobilePrevious" href="javascript:fullCardSlider[0].goToPrev()"><i class="fa fa-angle-left"></i><span>Previous</span></a>
      		<a class="mobileNext" href="javascript:fullCardSlider[0].goToNext()"><i class="fa fa-angle-right"></i><span>Next</span></a>
        	<a class="mobileLast" href="javascript:fullCardSlider[0].goToLast()"><i class="fa fa-angle-double-right"></i><span>Last</span></a>
        </div>
        <div id="singleCardHolder"><!-- singleCardHolder (start)-->
        	<div id="counterHolder" class="">
	        	<div id="counter"></div>
	        </div>
            <div id="cardOverflow" class="test"><!-- cardOverflow (start) -->
                <ul id="allCards">
                    {% for card in cards %}
                    <li class="hide" role="tabpanel">
                        {% for field in card.fields.reveal %}
                            {% include "_deck_card_fields.html" with field=field %}
                        {% endfor %}
                        <div class="hideRevealHr">
                            {% if is_quiz_mode %}
                            <a href="#" class="reveal">Reveal</a>
                            {% endif %}
                        </div>
                        <div class="{% if is_quiz_mode %}hide{% endif %}">
                        {% for field in card.fields.show %}
                            {% include "_deck_card_fields.html" with field=field hide=is_quiz_mode%}
                        {% endfor %}
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            </div><!-- cardOverflow (end) -->
        </div><!-- singleCardHolder (end)-->

    </div><!-- courseWrapper (end) -->

</div><!-- content (end) -->

</div><!-- contentWrapper (end) -->


<script type="text/javascript">
require(['jquery', 'lib', 'appendAround', 'jqueryui'], function($, lib) {
function parseURLParams(url) {
    var queryStart = url.indexOf("?") + 1,
        queryEnd   = url.indexOf("#") + 1 || url.length + 1,
        query = url.slice(queryStart, queryEnd - 1),
        pairs = query.replace(/\+/g, " ").split("&"),
        parms = {}, i, n, v, nv;

    if (query === url || query === "") {
        return;
    }

    for (i = 0; i < pairs.length; i++) {
        nv = pairs[i].split("=");
        n = decodeURIComponent(nv[0]);
        v = decodeURIComponent(nv[1]);

        if (!parms.hasOwnProperty(n)) {
            parms[n] = [];
        }

        parms[n].push(nv.length === 2 ? v : null);
    }
    return parms;
}

var pathname = $(location).attr('href');
var urlPar = parseURLParams(pathname);
current = 0;
if(typeof(urlPar) != "undefined"){
if(typeof(urlPar["cardLoc"]) != "undefined"){current = Number(urlPar["cardLoc"][0])-1}
}
sliders = [];
fullCardSlider = [];
sliderLength = $('ul#cards li').size();

$( "#slider" ).slider({
        orientation: "horizontal",
        min: 0,
        range: "min",
        max: sliderLength-1,
        step: 1,
        slide:function(event, ui){sliders[0].goToCard(ui.value)}
});

var sliderObjExist = false;
var Slider1 = lib.Slider;
$('.cardHolder').each(function() {
	if ( $(this).text() != '' ){
		//create Slider objects
		sliders.push(new Slider1(this,true,false));
		//sliders[i].respond();
		sliderObjExist = true;
	}
});


$('.test').each(function() {
	if ( $(this).text() != '' ){
		//create Slider objects
		fullCardSlider.push(new Slider1(this,true,true));
		//sliders[i].respond();
		sliderObjExist = true;
	}
});
console.log(fullCardSlider);

/* //RM
	document.getElementById("holder").style.display="block";
	document.getElementById("allCards").style.display="block";
*/
function updateCardLoc(loc){
    numCards = sliderLength;
	var location = Math.round((loc+1)/sliderLength*100) + '%  â€¢  Card '+ (loc + 1) + ' of ' + sliderLength;
	$('#cardLoc').text(location);
	$( "#slider" ).slider( "value", loc );
}


$(window).on("resize", function () {
    // to display the card location between the control buttons
    spaceBtwControls = $('#controlbar').width()- $('#first').width()-$('#last').width()-$('#next').width()-$('#previous').width();
    $('#cardIndex').width(spaceBtwControls + 'px');

	if ( sliderObjExist )
	{
		//console.log($('.sliderNav').css('display'));
		sliders[0].respond();
		fullCardSlider[0].respond();

	}
/* //RM
	var cardHolder = $('#singleCardHolder');
	var holderWidth = Math.round(cardHolder.width());
	var cardItems = $('#singleCardHolder ul li');
	var liCount = cardItems.length;
	//give each a card li the width of the container
	cardItems.width(holderWidth + 'px');
	//make the ul width big enough to fit all cards side by side
	var ulWidth = holderWidth * liCount;
	$('#singleCardHolder ul').width(ulWidth + 'px');

	//on first load show the first card
	cardItems.eq(current).show();
	sliders[0].goTo(current);

    updateCardLoc(current);
	document.getElementById(current).className = "clicked"
*/
	//change main card based on thumbnail click
	/*$('a.image').click(function(){
		var i = $(this).parent().index();

		if (i != current)
		{
			cardItems.eq(current).hide();
			document.getElementById(current).className = "";
            sliders[0].changeView(i);
			cardItems.eq(i).show();

			updateCardLoc(i);
			document.getElementById(i).className = "clicked"
			current = i;
		}
        else if (i===0 || i===sliderLength-1)
            sliders[0].goTo(i)

	});*/


}).resize();


/* accessibility (start) */
$('body').attr('role', 'application');

/* get the id of the key been pressed */
var getElementId = function($){
	return $.attr("id");
}

$('a').keydown(function(event){
	
	//console.log(event.keyCode);
	switch(event.keyCode)
	{
		case 9: //tab key
			//console.log($(this).attr('id'));
		break;
		case 13://enter key
			//$('#content').attr({ "role":"widget", "tabindex": "0" });
			//console.log(getLinkId($(this)));
			/*if (getElementId($this) == 'prevCard')
			{
				sliders[0].goToPrev();
			}
			else if (getLinkId($this) == 'firstCard')
			{
				sliders[0].goToFirstCard();
			}*/
		break;
	}
	
});
/* accessibility (end) */


$('.reveal').click(function() {
	var $show = $(this).parent().next();
	if ($show.hasClass('show')){
		$show.removeClass('show');
		$show.addClass('hide');
		$(this).text('Reveal');
	}else{
		$show.removeClass('hide');
		$show.addClass('show');
		$(this).text('Hide');
	}
	return false;
});



});

</script>

<script type="text/javascript">
require(['jquery', 'jquery.mousewheel'], function($) {

/*
$('#previous_card').click(function() {
    sliders[0].changeCard(-1);
    return false;
});
$('#next_card').click(function() {
    sliders[0].changeCard(1);
    return false;
});

$('#first_card').click(function() {
    sliders[0].firstCard();
    return false;
});

$('#last_card').click(function() {
    sliders[0].lastCard();
    return false;
});
*/
// scroll through the slider using horizontal mousewheel/touchpad

$('#cardSlider').mousewheel(function(event) {
      if (event.deltaX>0){
        event.preventDefault();
        sliders[0].goToNext();
      }
      else if (event.deltaX<0){
      	event.preventDefault();
        sliders[0].goToPrev();
      }
});

function checkKey(e) {
    var event = window.event ? window.event : e;
    if (true) {
        if (event.keyCode == 37)
            sliders[0].goToPrev()
        if (event.keyCode == 39)
            sliders[0].goToNext()    
    }
};
document.onkeydown=checkKey;

});
</script>

{% endblock %}
