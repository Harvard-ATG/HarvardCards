{% extends "__layout_left_sidebar.html" %}

{% block sidebar_content %}
	{% include "_deck_nav.html" with collection=collection deck=deck is_quiz_mode=is_quiz_mode %}
{% endblock %}

{% block main_content %}

<link href='http://fonts.googleapis.com/css?family=Vollkorn' rel='stylesheet' type='text/css'>


<div id="content"><!-- content (start) -->

    <div class="courseWrapper"><!-- courseWrapper (start) -->

        <div class="courseHeader"><!-- courseHeader (start) -->

            <h2 class="courseTitle">{{collection.title}}</h2><h3>{{deck.title}}</h3>
            {% if collection.id in user_collection_role.ADMIN %}
            <ul class="adminMenu adminMenuRight">
                <li><a href="#">Delete</a></li>
            </ul>
            {% endif %}
        </div><!-- courseHeader (end) -->

        <a href="#" id="addCard">Add Card</a>
        <div id="cardSlider">
            <div class="deckPrev"><a href="javascript:sliders[0].goToPrev()">&laquo; Prev</a></div>
            <div class="cardHolder" id="holder" style="display:none;">

                <ul id="cards">
                    {% for card in cards %}
                    <li id = {{forloop.counter0}}><a class="card" href="#">{{card.card_id}}</a></li>
                    {% endfor %}
                </ul>
            </div>
            <div class="deckNext"><a href="javascript:sliders[0].goToNext()">Next &raquo;</a></div>
            <!-- sliderNav (start) -->
            <!--<div class="deckNav">
                <ul class="deckNavNextPrev">
                    <li class="deckPrev"><a href="javascript:sliders[0].goToPrev()">&laquo; Prev</a></li>
                    <li class="deckNext"><a href="javascript:sliders[0].goToNext()">Next &raquo;</a></li>
                </ul>
            </div>-->
            <!-- sliderNav (end) -->

        </div>

        <div id="singleCardHolder"><!-- singleCardHolder (start)-->
            <div class = "controls" id="controlbar">
              <div style='float: left;' id ='first'>
                <a id="first_card" href="#">First</a>
              </div>
              <div style='float: left;' id="previous">
                <a id="previous_card" href="#">Previous</a>
              </div>
              <div style ='float:left;' id="cardIndex">
                <div style="text-align:center;" id="cardLoc"></div>
              </div>
              <div style='float: right;' id="last">
                <a id="last_card" href="#">Last</a>
              </div>
              <div style='float: right;' id="next">
                <a id="next_card" href="#">Next</a>
              </div>

            </div>
            <div id="cardOverflow"><!-- cardOverflow (start) -->
                <ul id="allCards" style="display:none;">
                    {% for card in cards %}
                    <li>
                        {% for field in card.fields.reveal %}
                            {% include "_deck_card_fields.html" with field=field %}
                        {% endfor %}
                        <div class="hideRevealHr">
                            {% if is_quiz_mode %}
                            <a href="#" class="reveal">Reveal</a>
                            {% endif %}
                        </div>
                        <div class="{% if is_quiz_mode %}hide{% endif %}">
                        {% for field in card.fields.show %}
                            {% include "_deck_card_fields.html" with field=field hide=is_quiz_mode%}
                        {% endfor %}
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            </div><!-- cardOverflow (end) -->
        </div><!-- singleCardHolder (end)-->

    </div><!-- courseWrapper (end) -->

</div><!-- content (end) -->

</div><!-- contentWrapper (end) -->


<script type="text/javascript">
require(['jquery', 'lib', 'appendAround'], function($, lib) {

sliders = [];
sliderLength = $('ul#cards li').size();
var sliderObjExist = false;
var Slider = lib.Slider;
$('.cardHolder').each(function() {
	if ( $(this).text() != '' ){
		//create Slider objects
		sliders.push(new Slider(this,true));
		//sliders[i].respond();
		sliderObjExist = true;
	}
});

document.getElementById("holder").style.display="block";
document.getElementById("allCards").style.display="block";

function updateCardLoc(loc){
    numCards = sliderLength;
	var location = Math.round((loc+1)/sliderLength*100) + '%  â€¢  Card '+ (loc + 1) + ' of ' + sliderLength;
	$('#cardLoc').text(location);
}

var current = 0;
$(window).on("resize", function () {
    // to display the card location between the control buttons
    spaceBtwControls = $('#controlbar').width()- $('#first').width()-$('#last').width()-$('#next').width()-$('#previous').width();
    $('#cardIndex').width(spaceBtwControls + 'px');

	if ( sliderObjExist )
	{
		//console.log($('.sliderNav').css('display'));
		sliders[0].respond();

	}

	var cardHolder = $('#singleCardHolder');
	var holderWidth = Math.round(cardHolder.width());
	var cardItems = $('#singleCardHolder ul li');
	var liCount = cardItems.length;
	//give each a card li the width of the container
	cardItems.width(holderWidth + 'px');
	//make the ul width big enough to fit all cards side by side
	var ulWidth = holderWidth * liCount;
	$('#singleCardHolder ul').width(ulWidth + 'px');

	//on first load show the first card
	cardItems.eq(current).show();
    updateCardLoc(0);
	document.getElementById(current).className = "clicked"

	//change main card based on thumbnail click
	$('a.card').click(function(){
		var i = $(this).parent().index();
		if (i != current)
		{
			cardItems.eq(current).hide();
			document.getElementById(current).className = ""
            sliders[0].changeView(i);
			cardItems.eq(i).show();
			updateCardLoc(i);
			document.getElementById(i).className = "clicked"
			current = i;
		}

	});


}).resize();


$('.reveal').click(function() {
	var $show = $(this).parent().next();
	if ($show.hasClass('show')){
		$show.removeClass('show');
		$show.addClass('hide');
		$(this).text('Reveal');
	}else{
		$show.removeClass('hide');
		$show.addClass('show');
		$(this).text('Hide');
	}
	return false;
});

});

</script>

<script>
require(['jquery', 'jquery.mousewheel'], function($) {

$('#previous_card').click(function() {
    sliders[0].changeCard(-1);
});
$('#next_card').click(function() {
    sliders[0].changeCard(1);
});

$('#first_card').click(function() {
    sliders[0].firstCard();
});

$('#last_card').click(function() {
    sliders[0].lastCard();
});

// scroll through the slider using horizontal mousewheel/touchpad

$('#cardSlider').mousewheel(function(event) {
	  event.preventDefault();
      if (event.deltaX>0)
        sliders[0].goToNext();
      else
        sliders[0].goToPrev();
});

function checkKey(e) {
    var event = window.event ? window.event : e;
    if (true) {
        if (event.keyCode == 37)
            $('#previous_card').click()
        if (event.keyCode == 39)
            $('#next_card').click()
    }
};
document.onkeydown=checkKey;

});
</script>

{% endblock %}
