{% extends "base.html" %}

{% block content %}
<style>
.row-fluid {
	width: 100%;
}
section.well-dark {
	background-color: #DDDDDD;
	border-radius: 10px;
	padding: 10px;
	min-width: 400px;
	margin: 10px;
}
.editable {
	font-size: 35px;
}
</style>
<form id="collection_form" method="POST">{% csrf_token %}
<div class="row-fluid">
	<section class="well-dark span8 offset2">
		<div class="form-horizontal row-fluid" method="POST">
			<div class="span6" style="height: 100%">
				{% if True %}
				<input type="text" name="title" value="" placeholder="Course name"/>
				{% else %}
				<div type="text" id="inputTitle" name="title" style="font-size: 35px">Title</div>
				{% endif %}
			</div>
			<div class="span6" style="height: 100%">
				{% if True %}
				<textarea name="description" placeholder="Description"></textarea>
				{% else %}
				<div id="inputDescription" name="description">Description</div>
				{% endif %}
			</div>

		</div>		
	</section>
</div>
<div id="wizarddd" class="row-fluid">
	<section class="well-dark span8 offset2">
		<div class="row-fluid">
			<div id="template1_btn" class="template-btn well span4">
				Template 1
			</div>
			<div id="template2_btn" class="template-btn well span4">
				Template 2
			</div>
			<div id="template3_btn" class="template-btn well span4">
				Template 3
			</div>
		</div>
	</section>
</div>
<script>
$(document).ready(function(){

	$('#inputTitle').editable(function(value, settings){
		return value;
	}, { 
		tooltip   : 'Click to edit...',
		cssclass: 'editable',
		style: 'inherit',
		onblur: 'submit',
		callback: function(value, settings){
			// TODO save
		}
	});
	$('#inputDescription').editable(function(value, settings){
		return value.replace(/\n/gi, "<br/>");
	}, {
		type      : 'textarea',
		rows: 10,
		//cancel    : 'Cancel',
		//submit    : 'OK',
		tooltip   : 'Click to edit...',
		onblur: 'submit'
	});
	
	$('.template-btn').click(function(){
		//var template_url = '/collection/wizarddd';
		//$('#wizarddd').load(template_url);
		// hide the options
		$('#wizarddd').addClass('hide');
		//show the selected..
		if($(this).attr("id") == 'template1_btn'){
			$('#template1').removeClass('hide');
			$('#template1').addClass('active-template');
		}
		if($(this).attr("id") == 'template2_btn'){
			$('#template2').removeClass('hide');
			$('#template2').addClass('active-template');
		}
		if($(this).attr("id") == 'template3_btn'){
			$('#template3').removeClass('hide');
			$('#template3').addClass('active-template');
		}
		$('#save_zone').removeClass('hide');
//		console.log(this);
	});
	

});
</script>





<style>
.options {
	padding: 8px;
}
.options li {
	margin: 4px;
}
.mysortable {
	border: dotted black 1px;
}
</style>

<div id="template1" class="well hide">
	<ul class="inline options">
		<li id="draggableText" class="draggable ui-state-highlight textDrag">Text</li>
		<li id="draggableSound" class="draggable ui-state-highlight textDrag">Sound</li>
		<li id="draggableImage" class="draggable ui-state-highlight imgDrag">Image</li>
		<li id="draggableVideo" class="draggable ui-state-highlight textDrag">Video</li>
	</ul>
	<ul id="sortable" class="unstyled">
		<li class="mysortable collection-type-text">
			<span class="mylabel">+label</span>
			<input type="text"/>
			<i class="icon-align-justify"></i>
			<i class="icon-remove-sign"></i>
			<input type="hidden" name="field_type1" value="text"/>
		</li>
		<li class="mysortable collection-type-img">
			<div class="mylabel">+label</div>
			<img src="https://encrypted-tbn3.gstatic.com/images?q=tbn:ANd9GcRd-pVDClrxvD-0hOaXVw2gDkHLy2Vi7rGulqTtNyg29_4shOoF"/>
			<i class="icon-align-justify"></i>
			<i class="icon-remove-sign"></i>
		</li>
		<li class="mysortable collection-type-text">
			<span class="mylabel"></span>
			<input type="text"/>
			<i class="icon-align-justify"></i>
			<i class="icon-remove-sign"></i>
		</li>
	</ul>
	
</div>

<div id="template2" class="well hide">
	<ul class="inline options">
		<li id="draggableText" class="draggable ui-state-highlight textDrag">Text</li>
		<li id="draggableSound" class="draggable ui-state-highlight textDrag">Sound</li>
		<li id="draggableImage" class="draggable ui-state-highlight imgDrag">Image</li>
		<li id="draggableVideo" class="draggable ui-state-highlight textDrag">Video</li>
	</ul>
	<ul id="sortable" class="unstyled">
		<li class="mysortable collection-type-text">
			<span class="mylabel">+label</span>
			<input type="text"/>
			<i class="icon-align-justify"></i>
			<i class="icon-remove-sign"></i>
		</li>
		<li class="mysortable collection-type-img">
			<div class="mylabel">+label</div>
			<img src="https://encrypted-tbn3.gstatic.com/images?q=tbn:ANd9GcRd-pVDClrxvD-0hOaXVw2gDkHLy2Vi7rGulqTtNyg29_4shOoF"/>
			<i class="icon-align-justify"></i>
			<i class="icon-remove-sign"></i>
		</li>
		<li class="mysortable collection-type-text">
			<span class="mylabel"></span>
			<input type="text"/>
			<i class="icon-align-justify"></i>
			<i class="icon-remove-sign"></i>
		</li>
	</ul>
	
</div>

<div id="template3" class="well hide">
	<ul class="inline options">
		<li id="draggableText" class="draggable ui-state-highlight textDrag">Text</li>
		<li id="draggableSound" class="draggable ui-state-highlight textDrag">Sound</li>
		<li id="draggableImage" class="draggable ui-state-highlight imgDrag">Image</li>
		<li id="draggableVideo" class="draggable ui-state-highlight textDrag">Video</li>
	</ul>
	<ul id="sortable" class="unstyled">
		<li class="mysortable collection-type-text">
			<span class="mylabel">+label</span>
			<input type="text"/>
			<i class="icon-align-justify"></i>
			<i class="icon-remove-sign"></i>
		</li>
		<li class="mysortable collection-type-img">
			<div class="mylabel">+label</div>
			<img src="https://encrypted-tbn3.gstatic.com/images?q=tbn:ANd9GcRd-pVDClrxvD-0hOaXVw2gDkHLy2Vi7rGulqTtNyg29_4shOoF"/>
			<i class="icon-align-justify"></i>
			<i class="icon-remove-sign"></i>
		</li>
		<li class="mysortable collection-type-text">
			<span class="mylabel"></span>
			<input type="text"/>
			<i class="icon-align-justify"></i>
			<i class="icon-remove-sign"></i>
		</li>
	</ul>
	
</div>

<div id="save_zone" class="well hide">
	<button id="save_btn" type="button" class='btn btn-success'>Save</button>
	<button id="cancel_btn" type="button" class='btn'>Cancel</button>
</div>

</form>

<script>
var textItem = '<span class="mylabel">+label</span> '
			+ '<input type="text"/> '
			+ '<i class="icon-align-justify"></i> '
			+ '<i class="icon-remove-sign"></i> ';
var imgItem = '<div class="mylabel">+label</div> '
			+'<img src="https://encrypted-tbn3.gstatic.com/images?q=tbn:ANd9GcRd-pVDClrxvD-0hOaXVw2gDkHLy2Vi7rGulqTtNyg29_4shOoF"/> '
			+'<i class="icon-align-justify"></i> '
			+'<i class="icon-remove-sign"></i> ';

setEditables = function(){
	$('.mylabel').editable(function(value, settings){
		return value;
	}, { 
		tooltip   : 'Click to edit...',
		placeholder: '+label',
		cssclass: 'editable',
		style: 'inherit',
		onblur: 'submit'
	});
}

$(document).ready(function(){
	$('#sortable').sortable({
		revert: true,
		update: function(event, ui){
			if($(ui.item).hasClass('mysortable')){

			} else {
				$(ui.item).removeClass('ui-state-highlight');
				$(ui.item).addClass('mysortable');

				if($(ui.item).hasClass('textDrag')){
					$(ui.item).html(textItem);					
				}
				if($(ui.item).hasClass('imgDrag')){
					$(ui.item).html(imgItem);
				}
				setEditables();
			}
		}
	});
	$('.draggable').draggable({
        connectToSortable: "#sortable",
        helper: "clone",
        revert: "invalid"
	});
	
	setEditables();

	$('#save_btn').click(function(){
		console.log("clicking the save");
		// create the field data json
		// get the active template class
		// get all mysortables...
		var data = [];
		$('.active-template .mysortable').each(function(index){
			console.log(index);
			data[index] = {};
			if($(this).hasClass('collection-type-text')){
				data[index]['type'] = 'text';
				console.log("text");
				console.log(data);
			}
			if($(this).hasClass('collection-type-img'))
				data[index]['type'] = 'image';
			var label = $(this).children('.mylabel').text();
			if(label != '+label' && label != '')
				data[index]['label'] = label;
			else 
				data[index]['label'] = '';
				
				
		});
		var json = JSON.stringify(data);
		console.log(json);

		var input = $("<input>").attr("type", "hidden").attr("name", "field_data").val(json);
		$('#collection_form').append($(input));
		
		console.log('submitting?');
		$('#collection_form').submit();
	});
	
});
</script>
{% endblock %}